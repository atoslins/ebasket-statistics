{% extends 'base.html' %}

{% block title %}Histórico de Confrontos - Início{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0">Selecione os Jogadores</h2>
            </div>
            <div class="card-body">
                <form id="confrontoForm" action="{{ url_for('confrontos.confrontos') }}" method="get">
                    <div class="mb-3">
                        <label for="jogador1" class="form-label">Jogador 1:</label>
                        <select class="form-select" id="jogador1" name="jogador1" required>
                            <option value="">Selecione um jogador</option>
                            {% for jogador in jogadores %}
                            <option value="{{ jogador.id }}">{{ jogador.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="jogador2" class="form-label">Jogador 2:</label>
                        <select class="form-select" id="jogador2" name="jogador2" required disabled>
                            <option value="">Primeiro selecione o Jogador 1</option>
                        </select>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary" id="btnVerConfrontos" disabled>Ver Confrontos</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const jogador1Select = document.getElementById('jogador1');
    const jogador2Select = document.getElementById('jogador2');
    const btnVerConfrontos = document.getElementById('btnVerConfrontos');
    
    jogador1Select.addEventListener('change', function() {
        const jogadorId = this.value;
        
        if (jogadorId) {
            // Enable jogador2 select
            jogador2Select.disabled = false;
            jogador2Select.innerHTML = '<option value="">Carregando adversários...</option>';
            
            // Fetch adversaries for the selected player
            fetch(`/api/jogadores/${jogadorId}/adversarios`)
                .then(response => response.json())
                .then(data => {
                    jogador2Select.innerHTML = '<option value="">Selecione um adversário</option>';
                    
                    if (data.length === 0) {
                        jogador2Select.innerHTML = '<option value="">Nenhum adversário encontrado</option>';
                        jogador2Select.disabled = true;
                        btnVerConfrontos.disabled = true;
                    } else {
                        data.forEach(adversario => {
                            const option = document.createElement('option');
                            option.value = adversario.id;
                            option.textContent = adversario.name;
                            jogador2Select.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    console.error('Erro ao carregar adversários:', error);
                    jogador2Select.innerHTML = '<option value="">Erro ao carregar adversários</option>';
                });
        } else {
            jogador2Select.innerHTML = '<option value="">Primeiro selecione o Jogador 1</option>';
            jogador2Select.disabled = true;
            btnVerConfrontos.disabled = true;
        }
    });
    
    jogador2Select.addEventListener('change', function() {
        btnVerConfrontos.disabled = !this.value;
    });
});
</script>
{% endblock %}
